services:
  docx-compare-orquestrador:
    build:
      context: .
      dockerfile: docker/Dockerfile.orquestrador
    container_name: docx-compare-orquestrador
    ports:
      - "5007:5007"
    environment:
      - FLASK_ENV=production
      - DIRECTUS_BASE_URL=${DIRECTUS_BASE_URL}
      - DIRECTUS_TOKEN=${DIRECTUS_TOKEN}
      - RESULTS_DIR=/app/results
      - ORQUESTRADOR_MODO=${ORQUESTRADOR_MODO:-sequencial}
      - ORQUESTRADOR_INTERVALO=${ORQUESTRADOR_INTERVALO:-60}
      - ORQUESTRADOR_PORTA=5007
      - ORQUESTRADOR_VERBOSE=${ORQUESTRADOR_VERBOSE:-false}
      - ORQUESTRADOR_SINGLE_RUN=${ORQUESTRADOR_SINGLE_RUN:-false}
      - CHECK_INTERVAL=${CHECK_INTERVAL:-60}
      - REQUEST_TIMEOUT=${REQUEST_TIMEOUT:-30}
      - VERBOSE_MODE=${VERBOSE_MODE:-false}
      - DRY_RUN=${DRY_RUN:-false}
    volumes:
      - ./results:/app/results
      - ./logs:/app/logs
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5007/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
